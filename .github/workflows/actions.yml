name: hello-world-actions

on: 
 push:
   branches:
     - "lab"
     - "staging"
     - "production"
 pull_request:
   branches:
     - "lab"
     - "staging"
     - "production"

env:
  GITHUB_PR_NUMBER: ${{github.event.pull_request.number}}
  GITHUB_EVENT_NAME: ${{github.event_name }}
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  GITHUB_HEAD_SHA: ${{ github.sha }}
  GITHUB_BASE_SHA: ${{ github.event.pull_request.head.sha }}
  
jobs: 
   update-status:
     runs-on: [self-hosted, macOS, X64]
     steps:
      - name: "set commit sha"
        run: |
         if [[ $GITHUB_EVENT_NAME = "push" ]]; then
           echo "COMMIT_SHA=$(echo $GITHUB_HEAD_SHA)" >> $GITHUB_ENV
         else
           echo "COMMIT_SHA=$(echo $GITHUB_BASE_SHA)" >> $GITHUB_ENV
         fi
      # - name: "notify jenkins"
      #   run: |
      #     echo $COMMIT_SHA
      - name: "update commit staus"
        run: >-
          curl \
            -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token $GITHUB_TOKEN" \
            https://api.github.com/repos/simpsons01/project-for-cicd/statuses/$COMMIT_SHA \
            -d '{ "state":"pending",  "context": "jenkins" }'
